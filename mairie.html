<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Photos - Mairie</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Barre haute avec boutons -->
  <header class="topbar">
    <button onclick="window.location.href='photo.html'">‚¨Ö Retour √† l'accueil</button>
    <div class="controls">
      <button id="btn-play-pause">‚è∏ Pause</button>
      <button id="btn-slow">üê¢ Lent</button>
      <button id="btn-normal">‚è± Normal</button>
      <button id="btn-fast">‚ö° Rapide</button>
      <span id="compteur">0 / 0</span>
    </div>
  </header>

  <!-- Grande photo d'accueil -->
  <section id="photo-principale">
    <img src="photos/accueil.jpg" alt="Photo des mari√©s" class="grande-photo">
  </section>

  <!-- Miniatures avec diaporama -->
  <section id="diaporama" class="miniatures"></section>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox hidden">
    <span id="lightbox-close" class="close">‚úñ</span>
    <img src="" alt="Photo en grand">
  </div>

  <script src="photoList.js"></script>
  <script>
    const extensions = [".jpg", ".jpeg", ".png", ".webp", ".gif"];
    const vitesses = {
      slow: 8000,
      normal: 4000,
      fast: 1500
    };

    let images = [];
    let imageIndex = 0;
    let intervalDiapo;
    let lectureAutomatique = true;
    let vitesseActuelle = vitesses.normal;

    const diaporama = document.getElementById("diaporama");
    const compteur = document.getElementById("compteur");
    const btnPlayPause = document.getElementById("btn-play-pause");
    const btnSlow = document.getElementById("btn-slow");
    const btnNormal = document.getElementById("btn-normal");
    const btnFast = document.getElementById("btn-fast");

    const lightbox = document.getElementById("lightbox");
    const lightboxImg = lightbox.querySelector("img");
    const lightboxClose = document.getElementById("lightbox-close");

    function chargerImages() {
      images = photoList.slice().sort((a, b) => a.localeCompare(b));
      images = images.filter(src => src !== "accueil.jpg");

      images.forEach(src => {
        const img = document.createElement("img");
        img.src = "photos/" + src;
        img.alt = "Photo mairie";
        img.setAttribute("tabindex", "-1");
        diaporama.appendChild(img);

        // Lightbox au clic
        img.addEventListener("click", () => ouvrirLightbox(img.src));

        // Hover : affichage plus grand (via CSS)
      });

      if (images.length > 0) {
        afficherImage(0);
        demarrerDiaporama();
      } else {
        compteur.textContent = "0 / 0";
      }
    }

    function afficherImage(index) {
      const allImages = diaporama.querySelectorAll("img");
      allImages.forEach((img, i) => {
        img.classList.toggle("active", i === index);
      });
      compteur.textContent = `${index + 1} / ${images.length}`;
      imageIndex = index;
    }

    function imageSuivante() {
      imageIndex = (imageIndex + 1) % images.length;
      afficherImage(imageIndex);
    }

    function demarrerDiaporama() {
      lectureAutomatique = true;
      btnPlayPause.textContent = "‚è∏ Pause";
      clearInterval(intervalDiapo);
      intervalDiapo = setInterval(imageSuivante, vitesseActuelle);
    }

    function arreterDiaporama() {
      lectureAutomatique = false;
      btnPlayPause.textContent = "‚ñ∂ Lecture";
      clearInterval(intervalDiapo);
    }

    btnPlayPause.addEventListener("click", () => {
      if (lectureAutomatique) {
        arreterDiaporama();
      } else {
        demarrerDiaporama();
      }
    });

    btnSlow.addEventListener("click", () => {
      vitesseActuelle = vitesses.slow;
      if (lectureAutomatique) demarrerDiaporama();
    });

    btnNormal.addEventListener("click", () => {
      vitesseActuelle = vitesses.normal;
      if (lectureAutomatique) demarrerDiaporama();
    });

    btnFast.addEventListener("click", () => {
      vitesseActuelle = vitesses.fast;
      if (lectureAutomatique) demarrerDiaporama();
    });

    // Lightbox
    function ouvrirLightbox(src) {
      lightboxImg.src = src;
      lightbox.classList.remove("hidden");
      document.body.style.overflow = "hidden";
      lightboxClose.focus();
    }

    function fermerLightbox() {
      lightbox.classList.add("hidden");
      lightboxImg.src = "";
      document.body.style.overflow = "";
    }

    lightboxClose.addEventListener("click", fermerLightbox);
    lightbox.addEventListener("click", (e) => {
      if (e.target === lightbox) fermerLightbox();
    });

    // Clavier
    document.addEventListener("keydown", (e) => {
      if (lightbox.style.display === "flex" || !lectureAutomatique) return;

      switch (e.key) {
        case "ArrowRight":
          imageSuivante();
          break;
        case " ":
          e.preventDefault();
          lectureAutomatique ? arreterDiaporama() : demarrerDiaporama();
          break;
      }
    });

    chargerImages();
  </script>
</body>
</html>

